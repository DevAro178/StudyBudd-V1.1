{"ast":null,"code":"var _jsxFileName = \"E:\\\\Django\\\\StudyBud FullStack\\\\frontend\\\\src\\\\context\\\\AuthContext.js\",\n  _s = $RefreshSig$();\nimport { createContext, useEffect } from \"react\";\nimport jwtDecode from \"jwt-decode\";\nimport { useNavigate } from \"react-router-dom\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { setUserId, setUser, setAuthTokens, setLoading, setUserName, setUserEmail, setIsLoggedIn, setPrevLocation, resetUserData } from \"../redux/userData\";\nimport { persistor } from \"../redux/store\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst AuthContext = /*#__PURE__*/createContext();\nexport const AuthProvider = _ref => {\n  _s();\n  let {\n    children\n  } = _ref;\n  const dispatch = useDispatch();\n  const navigate = useNavigate();\n  const {\n    user,\n    authTokens,\n    userId,\n    userName,\n    userEmail,\n    isLoggedIn,\n    loading,\n    userData,\n    prevLocation\n  } = useSelector(state => state.userData);\n  let loginUser = async (email, password) => {\n    const response = await fetch(\"http://127.0.0.1:8000/token/\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify({\n        email: email,\n        password: password\n      })\n    });\n    let data = await response.json();\n    if (data) {\n      // localStorage.setItem(\"authTokens\", JSON.stringify(data));\n      dispatch(setAuthTokens(data));\n      dispatch(setUser(jwtDecode(data.access)));\n      dispatch(setUserId(data.user_id));\n      dispatch(setUserEmail(data.email));\n      dispatch(setUserName(data.username));\n      dispatch(setIsLoggedIn(true));\n      if (prevLocation) {\n        navigate(prevLocation);\n      } else {\n        navigate(\"/\");\n      }\n    } else {\n      alert(\"Something went wrong while logging in the user!\");\n    }\n  };\n  let logoutUser = () => {\n    // localStorage.removeItem(\"authTokens\");\n    // dispatch(setAuthTokens(null));\n    // dispatch(setUser(null));\n    // dispatch(setUserId(null));\n    // dispatch(setUserEmail(null));\n    // dispatch(setUserName(null));\n    dispatch(resetUserData());\n    dispatch(setIsLoggedIn(false));\n    persistor.purge();\n  };\n  const updateToken = async () => {\n    const response = await fetch(\"http://127.0.0.1:8000/token/refresh/\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify({\n        refresh: authTokens === null || authTokens === void 0 ? void 0 : authTokens.refresh\n      })\n    });\n    const data = await response.json();\n    if (response.status === 200) {\n      dispatch(setAuthTokens(data));\n      dispatch(setUser(jwtDecode(data.access)));\n      // localStorage.setItem(\"authTokens\", JSON.stringify(data));\n    } else {\n      logoutUser();\n    }\n    if (loading) {\n      dispatch(setLoading(false));\n    }\n  };\n  let contextData = {\n    user,\n    authTokens,\n    loginUser,\n    logoutUser,\n    userId,\n    userName,\n    userEmail,\n    isLoggedIn,\n    userData\n  };\n  useEffect(() => {\n    if (loading) {\n      updateToken();\n    }\n    const REFRESH_INTERVAL = 1000 * 5 * 1; // 24 minutes\n    let interval = setInterval(() => {\n      if (authTokens) {\n        updateToken();\n      }\n    }, REFRESH_INTERVAL);\n    return () => clearInterval(interval);\n  }, [authTokens, loading]);\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: contextData,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 130,\n    columnNumber: 5\n  }, this);\n};\n_s(AuthProvider, \"dJK+ZovbkuGQP/WAUoLGZX6Tkrw=\", false, function () {\n  return [useDispatch, useNavigate, useSelector];\n});\n_c = AuthProvider;\nexport default AuthContext;\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["createContext","useEffect","jwtDecode","useNavigate","useDispatch","useSelector","setUserId","setUser","setAuthTokens","setLoading","setUserName","setUserEmail","setIsLoggedIn","setPrevLocation","resetUserData","persistor","AuthContext","AuthProvider","children","dispatch","navigate","user","authTokens","userId","userName","userEmail","isLoggedIn","loading","userData","prevLocation","state","loginUser","email","password","response","fetch","method","headers","body","JSON","stringify","data","json","access","user_id","username","alert","logoutUser","purge","updateToken","refresh","status","contextData","REFRESH_INTERVAL","interval","setInterval","clearInterval"],"sources":["E:/Django/StudyBud FullStack/frontend/src/context/AuthContext.js"],"sourcesContent":["import { createContext, useEffect } from \"react\";\r\nimport jwtDecode from \"jwt-decode\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport {\r\n  setUserId,\r\n  setUser,\r\n  setAuthTokens,\r\n  setLoading,\r\n  setUserName,\r\n  setUserEmail,\r\n  setIsLoggedIn,\r\n  setPrevLocation,\r\n  resetUserData,\r\n} from \"../redux/userData\";\r\nimport { persistor } from \"../redux/store\";\r\n\r\nconst AuthContext = createContext();\r\n\r\nexport const AuthProvider = ({ children }) => {\r\n  const dispatch = useDispatch();\r\n  const navigate = useNavigate();\r\n\r\n  const {\r\n    user,\r\n    authTokens,\r\n    userId,\r\n    userName,\r\n    userEmail,\r\n    isLoggedIn,\r\n    loading,\r\n    userData,\r\n    prevLocation,\r\n  } = useSelector((state) => state.userData);\r\n\r\n  let loginUser = async (email, password) => {\r\n    const response = await fetch(\"http://127.0.0.1:8000/token/\", {\r\n      method: \"POST\",\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n      },\r\n      body: JSON.stringify({\r\n        email: email,\r\n        password: password,\r\n      }),\r\n    });\r\n\r\n    let data = await response.json();\r\n\r\n    if (data) {\r\n      // localStorage.setItem(\"authTokens\", JSON.stringify(data));\r\n      dispatch(setAuthTokens(data));\r\n      dispatch(setUser(jwtDecode(data.access)));\r\n      dispatch(setUserId(data.user_id));\r\n      dispatch(setUserEmail(data.email));\r\n      dispatch(setUserName(data.username));\r\n      dispatch(setIsLoggedIn(true));\r\n      if (prevLocation) {\r\n        navigate(prevLocation);\r\n      } else {\r\n        navigate(\"/\");\r\n      }\r\n    } else {\r\n      alert(\"Something went wrong while logging in the user!\");\r\n    }\r\n  };\r\n\r\n  let logoutUser = () => {\r\n    // localStorage.removeItem(\"authTokens\");\r\n    // dispatch(setAuthTokens(null));\r\n    // dispatch(setUser(null));\r\n    // dispatch(setUserId(null));\r\n    // dispatch(setUserEmail(null));\r\n    // dispatch(setUserName(null));\r\n    dispatch(resetUserData());\r\n    dispatch(setIsLoggedIn(false));\r\n    persistor.purge();\r\n  };\r\n\r\n  const updateToken = async () => {\r\n    const response = await fetch(\"http://127.0.0.1:8000/token/refresh/\", {\r\n      method: \"POST\",\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n      },\r\n      body: JSON.stringify({ refresh: authTokens?.refresh }),\r\n    });\r\n\r\n    const data = await response.json();\r\n    if (response.status === 200) {\r\n      dispatch(setAuthTokens(data));\r\n      dispatch(setUser(jwtDecode(data.access)));\r\n      // localStorage.setItem(\"authTokens\", JSON.stringify(data));\r\n    } else {\r\n      logoutUser();\r\n    }\r\n\r\n    if (loading) {\r\n      dispatch(setLoading(false));\r\n    }\r\n  };\r\n\r\n  let contextData = {\r\n    user,\r\n    authTokens,\r\n    loginUser,\r\n    logoutUser,\r\n    userId,\r\n    userName,\r\n    userEmail,\r\n    isLoggedIn,\r\n    userData,\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (loading) {\r\n      updateToken();\r\n    }\r\n\r\n    const REFRESH_INTERVAL = 1000 * 5 * 1; // 24 minutes\r\n    let interval = setInterval(() => {\r\n      if (authTokens) {\r\n        updateToken();\r\n      }\r\n    }, REFRESH_INTERVAL);\r\n    return () => clearInterval(interval);\r\n  }, [authTokens, loading]);\r\n\r\n  return (\r\n    <AuthContext.Provider value={contextData}>{children}</AuthContext.Provider>\r\n  );\r\n};\r\n\r\nexport default AuthContext;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}